// WIT interface definition (informational - actual implementation uses direct calls)

package app:handler;

interface types {
    record request {
        method: string,
        payload: option<list<u8>>,
        input-stream: option<string>,
        metadata: list<tuple<string, string>>,
        context: request-context,
    }

    record request-context {
        request-id: string,
        service-name: string,
        timestamp: string,
        transport-info: option<transport-info>,
    }

    record transport-info {
        protocol: string,
        endpoint: string,
    }

    record response {
        code: u32,
        payload: option<list<u8>>,
        output-stream: option<string>,
        metadata: list<tuple<string, string>>,
        error: option<error-details>,
    }

    record error-details {
        message: string,
        code: string,
        details: option<list<u8>>,
    }

    record stream-context {
        stream-id: string,
        stream-type: string,
        metadata: list<tuple<string, string>>,
    }

    record method-config {
        name: string,
        request-streaming: bool,
        response-streaming: bool,
    }

    record stream-config {
        stream-type: string,
        bidirectional: bool,
    }
}

world handler {
    use types.{method-config, stream-config, request, response, stream-context};
    export list-methods: func() -> list<method-config>;
    export list-streams: func() -> list<stream-config>;
    export handle-request: func(req: request) -> response;
    export handle-stream-message: func(ctx: stream-context, payload: list<u8>) -> response;
}